<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />

    <title>VishwaFoodie | Orders Page</title>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.20.0/firebase-app.js";

      // If you enabled Analytics in your project, add the Firebase SDK for Google Analytics
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.20.0/firebase-analytics.js";

      // Add Firebase products that you want to use
      import { getAuth } from "https://www.gstatic.com/firebasejs/9.20.0/firebase-auth.js";

      import {
        getFirestore,
        collection,
        getDocs,
      } from "https://www.gstatic.com/firebasejs/9.20.0/firebase-firestore.js";
      const firebaseConfig = {
        apiKey: "AIzaSyD5TKCHJrdQan6mrfk4NmuaLYhzFx_G5AI",
        authDomain: "vihwafoodie.firebaseapp.com",
        projectId: "vihwafoodie",
        storageBucket: "vihwafoodie.appspot.com",
        messagingSenderId: "811791488279",
        appId: "1:811791488279:web:248ed320159d0debd49352",
        measurementId: "G-LMSRJT4128",
      };

      initializeApp(firebaseConfig);

      const db = getFirestore(); //database connection

      const collRef = collection(db, "orders"); //reference
      let orders = [];
      //get data
      getDocs(collRef)
        .then((snapshot) => {
          snapshot.docs.forEach((doc) => {
            orders.push(doc.data());
          });
          // console.log(orders)
          let placed_orders = [];
          orders.forEach((odr) => {
            console.log(odr);
            if (odr.status === "placed") {
              placed_orders.push(odr);
            }
          });
          console.log(placed_orders);

          // Dynamic card code

          const upcomingContainer = document.getElementById("upcoming");
          const progressContainer = document.getElementById("progress");
          const readyContainer = document.getElementById("ready");
          let number = 1;
          orders.forEach((order) => {
            // console.log(order.status)

            // Create card element
            const card = document.createElement("div");
            card.classList.add("card", "border-success", "mb-3");
            card.style.minWidth = "80%";
            card.style.maxWidth = "80%";
            card.style.borderRadius = "10px";

            // Create card header
            const cardHeader = document.createElement("div");
            cardHeader.classList.add(
              "card-header",
              "bg-transparent",
              "border-dark",
              "my-1"
            );

            const orderNumberHeading = document.createElement("h5");
            orderNumberHeading.style.fontWeight = "bold";
            // orderNumberHeading.textContent = `Order Number: ${order.canteen_id}`;
            orderNumberHeading.textContent = `Order Number: ${number}`;
            number++;
            cardHeader.appendChild(orderNumberHeading);
            card.appendChild(cardHeader);

            // Create card body
            const cardBody = document.createElement("div");
            cardBody.classList.add("card-body", "text-center");
            const table = document.createElement("table");
            table.classList.add("table", "table-bordered", "table-hover");
            const thead = document.createElement("thead");
            const headerRow = document.createElement("tr");
            const headerColumns = ["Item #", "Name", "Quantity"];
            headerColumns.forEach((columnTitle) => {
              const column = document.createElement("th");
              column.textContent = columnTitle;
              headerRow.appendChild(column);
            });
            thead.appendChild(headerRow);
            table.appendChild(thead);

            const tbody = document.createElement("tbody");
            order.food_items.forEach((item, index) => {
              console.log(item);
              const row = document.createElement("tr");
              const itemNumber = document.createElement("th");
              itemNumber.setAttribute("scope", "row");
              itemNumber.textContent = index + 1;
              const itemName = document.createElement("td");
              itemName.textContent = item.menu_item.name;
              const itemQuantity = document.createElement("td");
              itemQuantity.textContent = item.quantity;
              row.appendChild(itemNumber);
              row.appendChild(itemName);
              row.appendChild(itemQuantity);
              tbody.appendChild(row);
            });
            table.appendChild(tbody);
            cardBody.appendChild(table);
            card.appendChild(cardBody);

            // Create card footer
            const cardFooter = document.createElement("div");
            cardFooter.classList.add(
              "card-footer",
              "bg-transparent",
              "border-dark",
              "d-flex",
              "justify-content-center"
            );

            // ordersContainer.appendChild(card);
            if (order.status == "placed") {
              const markInProgressButton = document.createElement("button");
              markInProgressButton.classList.add("btn1", "mt-1", "mb-1");
              markInProgressButton.textContent = "Mark In-progress";
              markInProgressButton.addEventListener("click", () => {
                // Handle button click here
              });
              cardFooter.appendChild(markInProgressButton);
              card.appendChild(cardFooter);
              upcomingContainer.appendChild(card);
            }

            if (order.status == "progress") {
              const markReadyButton = document.createElement("button");
              markReadyButton.classList.add("btn1", "mt-1", "mb-1");
              markReadyButton.textContent = "Mark Ready";
              markReadyButton.addEventListener("click", () => {
                // Handle button click here
              });
              cardFooter.appendChild(markReadyButton);
              card.appendChild(cardFooter);

              progressContainer.appendChild(card);
            }
            if (order.status == "ready") {
              const deliveredButton = document.createElement("button");
              deliveredButton.classList.add("btn1", "mt-1", "mb-1","mx-3");
              deliveredButton.textContent = "Delivered";
              deliveredButton.addEventListener("click", () => {
                // Handle button click here
              });
              cardFooter.appendChild(deliveredButton);

              const cancelButton = document.createElement("button");
              cancelButton.classList.add("btn2", "mt-1", "mb-1","mx-3");
              cancelButton.textContent = "Cancel";
              cancelButton.addEventListener("click", () => {
                // Handle button click here
              });
              cardFooter.appendChild(cancelButton);

              card.appendChild(cardFooter);

              readyContainer.appendChild(card);
            }
          });
        })

        .catch((err) => {
          console.log(err.message);
        });

      // console.log(orders)
    </script>

    <style>
      .btn1 {
        border: none;
        outline: none;
        height: 40px;
        width: 45%;
        background-color: rgb(116, 0, 207);
        color: white;
        border-radius: 4px;
      }

      .btn1:hover {
        background: white;
        border: 1px solid;
        color: rgb(116, 0, 207);
      }

      .btn2 {
        border: none;
        outline: none;
        height: 40px;
        width: 45%;
        background-color: rgb(212, 53, 53);
        color: white;
        border-radius: 4px;
      }

      .btn2:hover {
        background: white;
        border: 1px solid;
        color: rgb(212, 53, 53);
      }
    </style>
  </head>

  <body>
    <!-- Navbar -->
    <nav
      class="navbar navbar-expand-lg navbar-light"
      style="background-color: #7400cf"
    >
      <a class="navbar-brand mx-4" href="#" style="color: white">
        VishwaFoodie</a
      >

      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item active">
            <a class="nav-link" href="#" style="color: white"
              >Home <span class="sr-only">(current)</span></a
            >
          </li>

          <li class="nav-item">
            <a class="nav-link" href="./orders.html" style="color: white"
              >Order History</a
            >
          </li>

          <li class="nav-item">
            <a class="nav-link" href="./login.html" style="color: white"
              >Log Out</a
            >
          </li>
        </ul>
      </div>
    </nav>
    <!-- Navbar -->

    <!-- Main -->

    <div class="row">
      <div class="col-sm min-vh-100" style="background-color: #f3e2ff">
        <div class="d-flex justify-content-center my-3">
          <h4>Upcoming Orders</h4>
        </div>

        <div class="row d-flex justify-content-center" id="upcoming">
   
        </div>
      </div>

      <!-- New coloumn -->

      <div class="col-sm min-vh-100" style="background-color: #fff9ac">
        <div class="d-flex justify-content-center my-3">
          <h4>Orders in Progress</h4>
        </div>

        <div class="row d-flex justify-content-center" id="progress">
          
        </div>
      </div>

      <div class="col-sm min-vh-100" style="background-color: #96ffa4">
        <div class="d-flex justify-content-center my-3">
          <h4>Ready Orders</h4>
        </div>

        <div class="row d-flex justify-content-center" id="ready">

        </div>
      </div>
    </div>

    <!-- Section: Design Block -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
    -->
  </body>
</html>
